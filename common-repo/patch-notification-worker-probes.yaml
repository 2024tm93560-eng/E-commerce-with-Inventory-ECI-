spec:
  template:
    spec:
      containers:
      - name: worker
        readinessProbe:
          exec:
            command:
            - sh
            - -lc
            - |
              python - <<'PY'
              import socket, os
              host = os.getenv("RABBITMQ_HOST","rabbitmq")
              s=socket.socket(); s.settimeout(2)
              s.connect((host,5672)); s.close()
              print("ok")
              PY
          initialDelaySeconds: 5
          periodSeconds: 10
          timeoutSeconds: 3
          failureThreshold: 3
        livenessProbe:
          exec:
            command:
            - sh
            - -lc
            - |
              pgrep -f "worker.py|notification|celery|rq|python" >/dev/null
          initialDelaySeconds: 20
          periodSeconds: 15
          timeoutSeconds: 3
          failureThreshold: 3
